
# **Lab 19: Azure Virtual Network (VNet) Peering â€“ Private Connectivity Across VNets**

---

## ğŸ§  Purpose of This Lab

This lab demonstrates **Azure Virtual Network (VNet) Peering**, a core networking concept used to enable **private, secure communication between isolated VNets**.

Although this lab could not be fully executed due to **Azure free subscription vCPU limits**, the **architecture, design principles, and configuration steps are fully documented**, exactly as used in real-world Azure environments.

> âš ï¸ **Important Note**
> Azure Free Trial allows limited vCPUs. This lab conceptually requires **3 VMs**, but only **2 VMs were deployed**.
> The design, behavior, and learning outcomes remain **100% valid and production-aligned**.

---

## 1ï¸âƒ£ Why Do We Need VNet Peering?

### ğŸ”¹ Default Azure Behavior (The Problem)

In Azure:

* Every **Virtual Network (VNet) is isolated by default**
* Even if VNets are:

  * In the same subscription
  * Same resource group
  * Same region

â¡ï¸ **VMs in different VNets cannot communicate using private IP addresses**

This isolation is intentional for **security and tenant separation**.

---

### ğŸ”¹ Real-World Scenarios Requiring VNet Peering

VNet Peering is commonly used when:

* Dev, Test, and Prod environments are separated into VNets
* Applications are split across multiple VNets
* Multiple teams manage different VNets but require connectivity
* Hub-and-Spoke network architecture
* Shared services (DNS, monitoring, AD) in a central VNet

---

## 2ï¸âƒ£ What Is Azure VNet Peering?

### âœ… Definition

**VNet Peering** connects two Azure VNets so that resources can communicate **privately** using private IP addresses.

### ğŸ” Key Characteristics

* Traffic flows over **Microsoftâ€™s private backbone**
* No need for:

  * VPN Gateway
  * Azure Firewall
  * Public IPs
  * NAT
* Low latency and high bandwidth
* Secure and private

ğŸ“Œ **Simple analogy**:

> VNet Peering is like **stitching two isolated networks together securely**.

---

## 3ï¸âƒ£ High-Level Architecture (Lab Design)

### ğŸ”¹ Logical Design

```
Azure Subscription
â””â”€â”€ Resource Group: rg-vnet-peering-lab
    â”œâ”€â”€ Virtual Network: vnet-dev (10.0.0.0/16)
    â”‚   â”œâ”€â”€ subnet-web (10.0.1.0/24)
    â”‚   â”‚   â””â”€â”€ vm-dev-web-01 (10.0.1.4)
    â”‚   â””â”€â”€ subnet-db (10.0.2.0/24)
    â”‚       â””â”€â”€ vm-dev-db-01 (planned)
    â”‚
    â”œâ”€â”€ Virtual Network: vnet-test (10.1.0.0/16)
    â”‚   â””â”€â”€ subnet-web (10.1.1.0/24)
    â”‚       â””â”€â”€ vm-test-web-01 (10.1.1.4)
    â”‚
    â””â”€â”€ VNet Peering
        â”œâ”€â”€ vnet-dev â†’ vnet-test
        â””â”€â”€ vnet-test â†’ vnet-dev
```

---

## 4ï¸âƒ£ Critical Design Rules (Very Important)

### âœ… Address Space Must NOT Overlap

```
vnet-dev  â†’ 10.0.0.0/16
vnet-test â†’ 10.1.0.0/16
```

Overlapping address spaces **will break peering**.

---

### âœ… Peering Is Bi-Directional

You must configure **two peerings**:

* VNet-A â†’ VNet-B
* VNet-B â†’ VNet-A

One-way peering is **not sufficient**.

---

### âŒ Peering Is NOT Transitive

If:

* VNet-A peers with VNet-B
* VNet-B peers with VNet-C

â¡ï¸ **VNet-A cannot talk to VNet-C automatically**

This is a **very common interview trap question**.

---

## 5ï¸âƒ£ Step-by-Step Lab Configuration

### ğŸ”¹ STEP 1: Create Resource Group

* Name: `rg-vnet-peering-lab`
* Region: Central India

---

### ğŸ”¹ STEP 2: Create First VNet (Dev)

* Name: `vnet-dev`
* Address space: `10.0.0.0/16`
* Subnets:

  * `subnet-web` â†’ `10.0.1.0/24`
  * `subnet-db` â†’ `10.0.2.0/24`

---

### ğŸ”¹ STEP 3: Deploy VM in VNet-Dev

* VM Name: `vm-dev-web-01`
* Size: B1s (1 vCPU)
* VNet: `vnet-dev`
* Subnet: `subnet-web`
* Public IP: Optional (for admin access)

Optional web server:

```bash
sudo apt update
sudo apt install apache2 -y
```

---

### ğŸ”¹ STEP 4: Create Second VNet (Test)

* Name: `vnet-test`
* Address space: `10.1.0.0/16`
* Subnet:

  * `subnet-web` â†’ `10.1.1.0/24`

---

### ğŸ”¹ STEP 5: Deploy VM in VNet-Test

* VM Name: `vm-test-web-01`
* Size: 1 vCPU
* VNet: `vnet-test`
* Subnet: `subnet-web`

---

## 6ï¸âƒ£ Connectivity Test (Before Peering)

From `vm-test-web-01`:

```bash
ping 10.0.1.4
```

âŒ **Fails**

### â“ Why?

Because VNets are **isolated by default**.

---

## 7ï¸âƒ£ Configure VNet Peering (Most Important Step)

### ğŸ”¹ STEP 6A: Dev â†’ Test

* Go to `vnet-dev`
* Peerings â†’ Add
* Name: `dev-to-test`
* Remote VNet: `vnet-test`
* Allow virtual network access âœ…

---

### ğŸ”¹ STEP 6B: Test â†’ Dev

* Go to `vnet-test`
* Peerings â†’ Add
* Name: `test-to-dev`
* Remote VNet: `vnet-dev`
* Allow virtual network access âœ…

ğŸ“Œ Both peerings should show **Connected**

---

## 8ï¸âƒ£ NSG Considerations

Even with peering:

* **NSGs still apply**
* Traffic can be blocked by NSG rules

Ensure NSG allows:

* ICMP (for ping), or
* TCP 80 (for HTTP testing)

Example:

```
Source: 10.0.0.0/8
Destination: Any
Protocol: ICMP / TCP
Action: Allow
```

---

## 9ï¸âƒ£ Connectivity Test (After Peering)

From `vm-test-web-01`:

```bash
ping 10.0.1.4
```

âœ… **Success**

If Apache installed:

```bash
curl http://10.0.1.4
```

---

## ğŸ”Ÿ Key Takeaways (AZ-104 + Interview Gold)

* VNets are isolated by default
* VNet peering enables private IP communication
* Peering:

  * Is bi-directional
  * Is non-transitive
* Address spaces must not overlap
* No gateways or public IPs required
* Traffic stays on Azure backbone

---

## ğŸ§  Why This Matters in Real Projects

* Enables multi-environment separation
* Reduces cost (no VPN gateway)
* Improves security posture
* Forms foundation for hub-and-spoke design
* Frequently used in enterprise Azure architectures
